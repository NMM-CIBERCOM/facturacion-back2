# üîß Diagn√≥stico - Perfiles No Cargan en Frontend

## üö® Problema Identificado

El frontend no est√° cargando los perfiles en el selector de configuraci√≥n de men√∫s. El endpoint `/api/menu-config/perfiles` existe pero no est√° devolviendo datos correctamente.

## üîç Diagn√≥stico Paso a Paso

### **Paso 1: Verificar Base de Datos**
```sql
@database_test_perfiles_endpoint.sql
```

Este script te mostrar√°:
- ‚úÖ **Consulta exacta del servicio** - Lo que deber√≠a devolver
- ‚úÖ **Estado de los perfiles** - Si tienen datos v√°lidos
- ‚úÖ **Usuarios y perfiles asignados** - Relaciones correctas
- ‚úÖ **Configuraci√≥n de men√∫s** - Por perfil
- ‚úÖ **Perfiles sin configuraci√≥n** - Que pueden causar problemas

### **Paso 2: Probar Endpoints de Diagn√≥stico**

#### **2.1: Probar Conexi√≥n a Base de Datos**
```bash
# Abrir navegador y ir a:
http://localhost:8080/api/test-menu/db-test
```

**Deber√≠a mostrar:**
```json
{
  "success": true,
  "totalPerfiles": 4,
  "message": "Conexi√≥n a base de datos exitosa"
}
```

#### **2.2: Probar Estructura de Tabla**
```bash
# Abrir navegador y ir a:
http://localhost:8080/api/test-menu/perfil-structure
```

**Deber√≠a mostrar la estructura de la tabla PERFIL**

#### **2.3: Probar Endpoint de Perfiles**
```bash
# Abrir navegador y ir a:
http://localhost:8080/api/test-menu/perfiles
```

**Deber√≠a mostrar:**
```json
[
  {
    "idPerfil": 1,
    "nombrePerfil": "Operador de Cr√©dito"
  },
  {
    "idPerfil": 2,
    "nombrePerfil": "Jefe de Cr√©dito"
  },
  {
    "idPerfil": 3,
    "nombrePerfil": "Administrador"
  },
  {
    "idPerfil": 99,
    "nombrePerfil": "Super Administrador"
  }
]
```

### **Paso 3: Probar Endpoint Original**
```bash
# Abrir navegador y ir a:
http://localhost:8080/api/menu-config/perfiles
```

**Deber√≠a mostrar el mismo resultado que el endpoint de prueba**

### **Paso 4: Verificar Logs del Backend**
```bash
# En la carpeta del proyecto backend:
grep -i "perfil\|menu" logs/server.log
```

## üõ†Ô∏è Posibles Soluciones

### **Soluci√≥n 1: Si el Endpoint de Prueba Funciona**
Si `/api/test-menu/perfiles` funciona pero `/api/menu-config/perfiles` no:
- El problema est√° en el `MenuConfigService`
- Revisar logs del servicio

### **Soluci√≥n 2: Si Ning√∫n Endpoint Funciona**
Si ambos endpoints fallan:
- Problema de conexi√≥n a base de datos
- Verificar configuraci√≥n de `application.yml`

### **Soluci√≥n 3: Si la Base de Datos Est√° Vac√≠a**
Si `totalPerfiles` es 0:
- Ejecutar `@database_create_all_users.sql` nuevamente
- Verificar que los perfiles se crearon correctamente

### **Soluci√≥n 4: Si Hay Error en la Consulta**
Si hay errores SQL:
- Verificar que la tabla `PERFIL` existe
- Verificar permisos de la base de datos

## üîß Archivos Creados para Diagn√≥stico

### **TestMenuController.java**
- ‚úÖ Endpoint `/api/test-menu/perfiles` - Prueba directa de perfiles
- ‚úÖ Endpoint `/api/test-menu/db-test` - Prueba de conexi√≥n
- ‚úÖ Endpoint `/api/test-menu/perfil-structure` - Estructura de tabla

### **database_test_perfiles_endpoint.sql**
- ‚úÖ Consulta exacta del servicio
- ‚úÖ Verificaci√≥n de datos de perfiles
- ‚úÖ Estado de configuraciones de men√∫s

## üöÄ Orden de Diagn√≥stico

1. **Ejecutar script de base de datos**: `@database_test_perfiles_endpoint.sql`
2. **Probar conexi√≥n**: `http://localhost:8080/api/test-menu/db-test`
3. **Probar perfiles**: `http://localhost:8080/api/test-menu/perfiles`
4. **Probar endpoint original**: `http://localhost:8080/api/menu-config/perfiles`
5. **Revisar logs del backend**
6. **Aplicar soluci√≥n seg√∫n el problema encontrado**

## ‚ö†Ô∏è Importante

- ‚úÖ **Los endpoints de prueba son seguros** - Solo consultan datos
- ‚úÖ **No modifican nada** - Solo diagnostican el problema
- ‚úÖ **Identifican la causa exacta** - Del problema de carga
- ‚úÖ **Permiten soluci√≥n dirigida** - Seg√∫n el problema espec√≠fico

## üîß Si A√∫n No Funciona

### **Verificar Configuraci√≥n de Base de Datos**
```yaml
# En application.yml verificar:
spring:
  datasource:
    url: jdbc:oracle:thin:@localhost:1521:XE
    username: tu_usuario
    password: tu_password
```

### **Verificar Logs Espec√≠ficos**
```bash
grep -i "MenuConfigService\|obtenerPerfiles" logs/server.log
```

---

**Ejecuta primero `@database_test_perfiles_endpoint.sql` y luego prueba los endpoints de diagn√≥stico para identificar la causa exacta del problema.**
