# üì± Soluci√≥n Alternativa: Usar C√≥digo QR para 2FA

## üîß **Problema Identificado**
Google Authenticator no est√° aceptando las claves manuales. Vamos a usar el c√≥digo QR directamente.

## ‚ö° **Soluci√≥n con C√≥digo QR**

### **Paso 1: Configurar clave perfecta en BD**
```sql
-- Ejecutar en Oracle SQL Developer
@database_qr_solution.sql
```

### **Paso 2: Obtener c√≥digo QR del backend**
```bash
POST http://localhost:8080/api/auth/2fa/setup?username=admin
```

**Respuesta esperada:**
```json
{
  "success": true,
  "setup": {
    "qrCodeUrl": "otpauth://totp/Cibercom%20Facturaci√≥n:admin?secret=ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&issuer=Cibercom%20Facturaci√≥n",
    "secretKey": "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",
    "enabled": false,
    "message": "Escanea el c√≥digo QR con Google Authenticator y luego activa la autenticaci√≥n"
  }
}
```

### **Paso 3: Generar imagen QR**
1. **Copiar el `qrCodeUrl`** de la respuesta
2. **Ir a**: https://www.qr-code-generator.com/
3. **Pegar la URL** en el generador
4. **Generar c√≥digo QR**
5. **Descargar la imagen**

### **Paso 4: Escanear con Google Authenticator**
1. **Abrir Google Authenticator**
2. **Tocar "Agregar cuenta"**
3. **Seleccionar "Escanear c√≥digo QR"**
4. **Escanear la imagen QR generada**
5. **Verificar que aparezca la cuenta "Cibercom Facturaci√≥n - admin"**

## üîÑ **Alternativa: Usar URL directa**

### **Opci√≥n A: Convertir URL a imagen**
```bash
# Usar la URL directamente para generar QR
https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=otpauth://totp/Cibercom%20Facturaci√≥n:admin?secret=ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&issuer=Cibercom%20Facturaci√≥n
```

### **Opci√≥n B: Usar aplicaci√≥n web**
1. **Ir a**: https://www.qr-code-generator.com/
2. **Pegar la URL completa del `qrCodeUrl`**
3. **Generar y descargar QR**
4. **Escanear con Google Authenticator**

## üöÄ **Prueba del 2FA**

### **1. Activar 2FA:**
```bash
POST http://localhost:8080/api/auth/2fa/enable?username=admin&code=123456
```
*(Usar el c√≥digo de 6 d√≠gitos de Google Authenticator)*

### **2. Probar login completo:**
1. **Abrir frontend** (http://localhost:3000)
2. **Login**: `admin` / `admin`
3. **Deber√≠a aparecer pantalla de 2FA**
4. **Ingresar c√≥digo de 6 d√≠gitos**
5. **¬°Acceso completo!**

## üîç **Verificaci√≥n**

Si todo funciona correctamente:
- ‚úÖ **Google Authenticator**: Muestra c√≥digo de 6 d√≠gitos
- ‚úÖ **Backend**: Acepta el c√≥digo de activaci√≥n
- ‚úÖ **Frontend**: Muestra pantalla de 2FA

## üö® **Si sigue fallando**

### **Alternativa: Deshabilitar 2FA temporalmente**
```sql
-- Deshabilitar 2FA para testing
UPDATE USER_2FA_CONFIG 
SET ENABLED = 'N'
WHERE USERNAME = 'admin';
COMMIT;
```

---

**¬°Usa el c√≥digo QR en lugar de la clave manual!**
