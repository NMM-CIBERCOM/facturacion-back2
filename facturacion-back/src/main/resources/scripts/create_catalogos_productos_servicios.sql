-- Script para crear la tabla de catálogos de productos/servicios por cliente
-- Cada cliente/usuario puede tener su propio catálogo personalizado

CREATE TABLE CATALOGOS_PRODUCTOS_SERVICIOS (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_USUARIO NUMBER NOT NULL,
    CLAVE_PROD_SERV VARCHAR2(20) NOT NULL,
    CANTIDAD NUMBER(18,6) DEFAULT 1 NOT NULL,
    UNIDAD VARCHAR2(10) DEFAULT 'E48' NOT NULL,
    DESCRIPCION VARCHAR2(500) NOT NULL,
    OBJETO_IMPUESTO VARCHAR2(2) DEFAULT '02' NOT NULL,
    VALOR_UNITARIO NUMBER(18,2) DEFAULT 0 NOT NULL,
    IMPORTE NUMBER(18,2) DEFAULT 0 NOT NULL,
    TASA_IVA NUMBER(5,2) DEFAULT 0,
    FECHA_CREACION TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    FECHA_ACTUALIZACION TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    ACTIVO CHAR(1) DEFAULT '1' NOT NULL CHECK (ACTIVO IN ('0', '1')),
    
    CONSTRAINT UK_CATALOGO_USUARIO_CLAVE UNIQUE (ID_USUARIO, CLAVE_PROD_SERV)
);

-- Índices para mejorar el rendimiento
CREATE INDEX IDX_CATALOGO_USUARIO ON CATALOGOS_PRODUCTOS_SERVICIOS(ID_USUARIO);
CREATE INDEX IDX_CATALOGO_ACTIVO ON CATALOGOS_PRODUCTOS_SERVICIOS(ACTIVO);
CREATE INDEX IDX_CATALOGO_CLAVE ON CATALOGOS_PRODUCTOS_SERVICIOS(CLAVE_PROD_SERV);

-- Comentarios en las columnas
COMMENT ON TABLE CATALOGOS_PRODUCTOS_SERVICIOS IS 'Catálogo personalizado de productos y servicios por usuario/cliente';
COMMENT ON COLUMN CATALOGOS_PRODUCTOS_SERVICIOS.ID IS 'Identificador único del registro';
COMMENT ON COLUMN CATALOGOS_PRODUCTOS_SERVICIOS.ID_USUARIO IS 'ID del usuario/cliente dueño del catálogo';
COMMENT ON COLUMN CATALOGOS_PRODUCTOS_SERVICIOS.CLAVE_PROD_SERV IS 'Clave de producto o servicio del catálogo SAT';
COMMENT ON COLUMN CATALOGOS_PRODUCTOS_SERVICIOS.CANTIDAD IS 'Cantidad por defecto';
COMMENT ON COLUMN CATALOGOS_PRODUCTOS_SERVICIOS.UNIDAD IS 'Unidad de medida (E48, MTR, KGM, etc.)';
COMMENT ON COLUMN CATALOGOS_PRODUCTOS_SERVICIOS.DESCRIPCION IS 'Descripción del producto o servicio';
COMMENT ON COLUMN CATALOGOS_PRODUCTOS_SERVICIOS.OBJETO_IMPUESTO IS 'Objeto de impuesto (01, 02, 03)';
COMMENT ON COLUMN CATALOGOS_PRODUCTOS_SERVICIOS.VALOR_UNITARIO IS 'Valor unitario por defecto';
COMMENT ON COLUMN CATALOGOS_PRODUCTOS_SERVICIOS.IMPORTE IS 'Importe calculado (cantidad * valor unitario)';
COMMENT ON COLUMN CATALOGOS_PRODUCTOS_SERVICIOS.TASA_IVA IS 'Tasa de IVA aplicable';
COMMENT ON COLUMN CATALOGOS_PRODUCTOS_SERVICIOS.ACTIVO IS 'Indica si el registro está activo (1) o inactivo (0)';

