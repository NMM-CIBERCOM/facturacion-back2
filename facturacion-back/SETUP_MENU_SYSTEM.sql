-- Script completo para configurar el sistema de menús dinámicos
-- Ejecutar este script para configurar todo el sistema

-- 1. Crear tabla MENU_CONFIG
CREATE TABLE MENU_CONFIG (
    ID_CONFIG NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_PERFIL NUMBER NOT NULL,
    MENU_LABEL VARCHAR2(100) NOT NULL,
    MENU_PATH VARCHAR2(200),
    IS_VISIBLE NUMBER(1) DEFAULT 1,
    ORDEN NUMBER DEFAULT 0,
    FECHA_CREACION DATE DEFAULT SYSDATE,
    FECHA_MODIFICACION DATE DEFAULT SYSDATE,
    USUARIO_CREACION VARCHAR2(50),
    USUARIO_MODIFICACION VARCHAR2(50),
    CONSTRAINT FK_MENU_CONFIG_PERFIL FOREIGN KEY (ID_PERFIL) REFERENCES PERFIL(ID_PERFIL)
);

-- 2. Crear usuarios para los perfiles
-- Jefe de Crédito
INSERT INTO USUARIOS (NO_USUARIO, NOMBRE_EMPLEADO, PASSWORD, ID_PERFIL, ESTATUS_USUARIO, FECHA_ALTA, USUARIO_CREACION) 
VALUES ('jefe001', 'Jefe de Crédito', 'jefe123', 2, 'ACTIVO', SYSDATE, 'admin');

-- Operador de Crédito  
INSERT INTO USUARIOS (NO_USUARIO, NOMBRE_EMPLEADO, PASSWORD, ID_PERFIL, ESTATUS_USUARIO, FECHA_ALTA, USUARIO_CREACION) 
VALUES ('oper001', 'Operador de Crédito', 'oper123', 1, 'ACTIVO', SYSDATE, 'admin');

-- 3. Configurar menús por defecto
-- Administrador (ID_PERFIL = 3) - Todos los menús visibles incluyendo Configuración
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (3, 'Dashboard', 'dashboard', 1, 1, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (3, 'Facturación', NULL, 1, 2, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (3, 'Consultas', NULL, 1, 3, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (3, 'Administración', NULL, 1, 4, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (3, 'Reportes Facturación Fiscal', NULL, 1, 5, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (3, 'Registro CFDI', NULL, 1, 6, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (3, 'Monitor', NULL, 1, 7, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (3, 'Configuración', NULL, 1, 8, 'admin');

-- Jefe de Crédito (ID_PERFIL = 2) - Todos los menús visibles EXCEPTO Configuración
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (2, 'Dashboard', 'dashboard', 1, 1, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (2, 'Facturación', NULL, 1, 2, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (2, 'Consultas', NULL, 1, 3, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (2, 'Administración', NULL, 1, 4, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (2, 'Reportes Facturación Fiscal', NULL, 1, 5, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (2, 'Registro CFDI', NULL, 1, 6, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (2, 'Monitor', NULL, 1, 7, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (2, 'Configuración', NULL, 0, 8, 'admin'); -- OCULTO para Jefe de Crédito

-- Operador de Crédito (ID_PERFIL = 1) - Todos los menús visibles EXCEPTO Configuración
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (1, 'Dashboard', 'dashboard', 1, 1, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (1, 'Facturación', NULL, 1, 2, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (1, 'Consultas', NULL, 1, 3, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (1, 'Administración', NULL, 1, 4, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (1, 'Reportes Facturación Fiscal', NULL, 1, 5, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (1, 'Registro CFDI', NULL, 1, 6, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (1, 'Monitor', NULL, 1, 7, 'admin');
INSERT INTO MENU_CONFIG (ID_PERFIL, MENU_LABEL, MENU_PATH, IS_VISIBLE, ORDEN, USUARIO_CREACION) VALUES (1, 'Configuración', NULL, 0, 8, 'admin'); -- OCULTO para Operador de Crédito

COMMIT;

-- Verificar que todo se creó correctamente
SELECT 'Usuarios creados:' as INFO FROM DUAL;
SELECT NO_USUARIO, NOMBRE_EMPLEADO, ID_PERFIL FROM USUARIOS WHERE NO_USUARIO IN ('admin', 'admin001', 'jefe001', 'oper001');

SELECT 'Configuración de menús creada:' as INFO FROM DUAL;
SELECT ID_PERFIL, MENU_LABEL, IS_VISIBLE, ORDEN FROM MENU_CONFIG ORDER BY ID_PERFIL, ORDEN;
