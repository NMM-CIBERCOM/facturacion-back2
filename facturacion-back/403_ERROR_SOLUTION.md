# üîß Soluci√≥n - Error 403 en Endpoints de Prueba

## üö® Problema Identificado

Los endpoints de prueba est√°n devolviendo **HTTP ERROR 403** - "Se deneg√≥ el acceso a localhost". Esto indica que Spring Security est√° bloqueando el acceso, aunque la configuraci√≥n ya incluye los endpoints.

## üîç Diagn√≥stico

### **Paso 1: Verificar Base de Datos Primero**
```sql
@database_simple_perfiles_check.sql
```

Este script te mostrar√°:
- ‚úÖ **Perfiles existentes** en la tabla PERFIL
- ‚úÖ **Usuarios activos** y sus perfiles
- ‚úÖ **Configuraci√≥n de men√∫s** por perfil
- ‚úÖ **Perfiles sin configuraci√≥n**

### **Paso 2: Probar Endpoint Original Directamente**
```sql
@database_test_original_endpoint.sql
```

Este script te mostrar√°:
- ‚úÖ **Consulta exacta del servicio** - Lo que deber√≠a devolver
- ‚úÖ **Verificaci√≥n de datos NULL** - Si hay problemas de datos
- ‚úÖ **Estructura de tabla PERFIL** - Si est√° correcta
- ‚úÖ **Consulta con alias** - Como en el servicio

## üõ†Ô∏è Soluci√≥n

### **Opci√≥n 1: Reiniciar Servidor Backend**
El problema m√°s probable es que el servidor no se reinici√≥ despu√©s de crear los nuevos controladores:

1. **Detener el servidor backend**
2. **Reiniciar el servidor backend**
3. **Probar los endpoints nuevamente**

### **Opci√≥n 2: Probar Endpoint Original Directamente**
En lugar de usar los endpoints de prueba, prueba directamente:

```bash
# Probar endpoint original de perfiles
http://localhost:8080/api/menu-config/perfiles
```

### **Opci√≥n 3: Verificar Logs del Backend**
```bash
# Buscar errores espec√≠ficos
grep -i "error\|exception\|perfil" logs/server.log
```

## üîç Verificaci√≥n Post-Soluci√≥n

### **Verificar que los Perfiles Existen**
```sql
SELECT 
    ID_PERFIL,
    NOMBRE_PERFIL
FROM PERFIL
ORDER BY NOMBRE_PERFIL;
```

**Deber√≠a mostrar 4 perfiles:**
- Super Administrador (ID: 99)
- Administrador (ID: 3)
- Jefe de Cr√©dito (ID: 2)
- Operador de Cr√©dito (ID: 1)

### **Verificar que el Endpoint Funciona**
```bash
# Probar en navegador:
http://localhost:8080/api/menu-config/perfiles
```

**Deber√≠a mostrar:**
```json
[
  {
    "idPerfil": 1,
    "nombrePerfil": "Operador de Cr√©dito"
  },
  {
    "idPerfil": 2,
    "nombrePerfil": "Jefe de Cr√©dito"
  },
  {
    "idPerfil": 3,
    "nombrePerfil": "Administrador"
  },
  {
    "idPerfil": 99,
    "nombrePerfil": "Super Administrador"
  }
]
```

## ‚ö†Ô∏è Importante

- ‚úÖ **La configuraci√≥n de seguridad est√° correcta** - Incluye todos los endpoints
- ‚úÖ **El problema es de reinicio** - El servidor necesita reiniciarse
- ‚úÖ **Los scripts de BD son seguros** - Solo consultan datos
- ‚úÖ **El endpoint original deber√≠a funcionar** - Despu√©s del reinicio

## üîß Si A√∫n No Funciona

### **Verificar que el Servidor Est√° Corriendo**
```bash
# Verificar puerto 8080
netstat -an | findstr :8080
```

### **Verificar Logs de Inicio**
```bash
# Buscar errores de inicio
grep -i "started\|error\|failed" logs/server.log
```

### **Probar Endpoint de Health Check**
```bash
# Probar health check
http://localhost:8080/api/menu-config/health
```

---

**Ejecuta primero `@database_simple_perfiles_check.sql` para verificar que los perfiles existen, luego reinicia el servidor backend y prueba `http://localhost:8080/api/menu-config/perfiles`.**
