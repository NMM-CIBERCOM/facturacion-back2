# üö® Soluci√≥n R√°pida - Error 401 y JSON

## üîç Problema Identificado

La consola muestra:
- ‚úÖ **Usuarios existen**: admin, jefe, operador, SUPERADMIN
- ‚ùå **Backend responde 401**: Rechaza las credenciales
- ‚ùå **Error JSON**: El backend no env√≠a respuesta JSON v√°lida

## üõ†Ô∏è Soluci√≥n R√°pida

### **Paso 1: Ejecutar Recuperaci√≥n B√°sica**
```sql
@database_quick_fix.sql
```

Este script:
- ‚úÖ Crea columnas faltantes en `USUARIOS`
- ‚úÖ Crea tabla `USER_PAYMENT_STATUS`
- ‚úÖ Asigna estados de pago por defecto (`PAID`)
- ‚úÖ Configura `SUPERADMIN` con rol correcto
- ‚úÖ Crea funci√≥n de acceso

### **Paso 2: Verificar Contrase√±as**
```sql
@database_check_passwords.sql
```

Este script te mostrar√°:
- ‚úÖ Contrase√±as actuales de los usuarios
- ‚úÖ Si est√°n codificadas o en texto plano
- ‚úÖ Estado de cada usuario

### **Paso 3: Probar Acceso**

Despu√©s de ejecutar los scripts, prueba con:

#### **Credenciales de Prueba**
- **Usuario**: `admin`
- **Contrase√±a**: `admin` (o la que muestre el script)

- **Usuario**: `SUPERADMIN`  
- **Contrase√±a**: `admin123`

## üîß ¬øPor Qu√© Falla?

### **Problema 1: Columnas Faltantes**
El c√≥digo Java espera columnas que no existen:
- `USER_ROLE`
- `PASSWORD_ENCODED`
- `TWO_FACTOR_ENABLED`
- `LAST_LOGIN`

### **Problema 2: Tabla de Estados de Pago**
No existe `USER_PAYMENT_STATUS`, causando errores en la funci√≥n de acceso.

### **Problema 3: Funci√≥n de Acceso**
`FN_USER_HAS_ACCESS` no existe, causando errores en consultas.

## üöÄ Orden de Ejecuci√≥n

1. **Primero**: `@database_quick_fix.sql`
2. **Segundo**: `@database_check_passwords.sql`
3. **Tercero**: Reiniciar el servidor backend
4. **Cuarto**: Probar login en el frontend

## üîç Verificaci√≥n Post-Fix

### **Verificar que Todo Funciona**
```sql
-- Probar funci√≥n de acceso
SELECT FN_USER_HAS_ACCESS('admin') FROM DUAL;
-- Debe retornar 'Y'

-- Ver todos los usuarios con acceso
SELECT 
    u.NO_USUARIO,
    FN_USER_HAS_ACCESS(u.NO_USUARIO) AS TIENE_ACCESO
FROM USUARIOS u
WHERE u.ESTATUS_USUARIO = 'A';
```

### **Verificar Contrase√±as**
```sql
-- Ver contrase√±as de usuarios principales
SELECT 
    NO_USUARIO,
    PASSWORD,
    PASSWORD_ENCODED
FROM USUARIOS
WHERE NO_USUARIO IN ('admin', 'jefe', 'operador', 'SUPERADMIN');
```

## ‚ö†Ô∏è Importante

- ‚úÖ **Los scripts son seguros** - No modifican datos existentes
- ‚úÖ **Solo agregan funcionalidad** - Preservan usuarios y perfiles
- ‚úÖ **Solucionan el error 401** - Configuran el sistema correctamente

## üîß Si A√∫n No Funciona

### **Verificar Logs del Servidor**
```bash
# Buscar errores espec√≠ficos
grep -i "error\|exception" logs/server.log
```

### **Probar Endpoint Directamente**
```bash
# Probar login con curl
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"usuario":"admin","password":"admin"}'
```

---

**Ejecuta `@database_quick_fix.sql` primero. Este script solucionar√° el problema del error 401 y la respuesta JSON.**
